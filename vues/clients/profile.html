<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Profil utilisateur</title>
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      .profile-header {
        display: flex;
        align-items: center;
        gap: 24px;
        margin-bottom: 2rem;
        background: var(--color-surface);
        border-radius: 12px;
        padding: 2rem 2rem 1.5rem 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .profile-avatar {
        width: 110px;
        height: 110px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--color-primary);
        background: var(--color-bg-alt);
      }
      .profile-info {
        flex: 1;
      }
      .profile-name {
        font-size: 2rem;
        font-weight: bold;
        color: var(--color-text);
        margin-bottom: 0.5rem;
      }
      .profile-actions {
        margin-top: 1rem;
      }
      .profile-btn {
        background: var(--color-primary);
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 10px 22px;
        font-size: 1.1rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
        margin-right: 1rem;
      }
      .profile-btn:hover {
        background: var(--color-primary-dark);
      }
      .profile-posts-title {
        font-size: 1.3rem;
        color: var(--color-primary);
        margin-bottom: 1rem;
        margin-top: 2rem;
      }
      .profile-posts-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div
      class="container"
      style="max-width: 700px; margin: 40px auto 0 auto; padding: 2rem"
    >
      <div id="profile-header" class="profile-header">
        <img
          id="profile-avatar"
          class="profile-avatar"
          src="../../assets/images/default-avatar.png"
          alt="avatar"
        />
        <div class="profile-info">
          <div id="profile-name" class="profile-name">Utilisateur inconnu</div>
          <div class="profile-actions">
            <button id="message-btn" class="profile-btn">
              <i class="fa-solid fa-paper-plane"></i> Envoyer un message
            </button>
          </div>
        </div>
      </div>
      <div class="profile-posts-title">Ses derniers posts</div>
      <div id="profile-posts" class="profile-posts-list"></div>
    </div>
    <script>
      // Récupère l'user_id dans l'URL
      function getUserId() {
        const params = new URLSearchParams(window.location.search);
        return params.get("user_id");
      }
      const userId = getUserId();
      if (!userId) {
        document.getElementById("profile-header").innerHTML =
          '<div style="color:red">Utilisateur inconnu.</div>';
        document.getElementById("profile-posts").innerHTML = "";
      } else {
        // Récupère les infos utilisateur
        fetch("../../api/users/get_user.php?user_id=" + userId)
          .then((r) => r.json())
          .then((data) => {
            if (data.success && data.user) {
              document.getElementById("profile-name").textContent =
                data.user.prenom + " " + data.user.nom;
              document.getElementById("profile-avatar").src =
                "../../assets/images/" +
                (data.user.avatar || "default-avatar.png");
              document.getElementById("message-btn").onclick = function () {
                window.location.href = "chat.html?user_id=" + userId;
              };
            } else {
              document.getElementById("profile-header").innerHTML =
                '<div style="color:red">Utilisateur introuvable.</div>';
            }
          });
        // Récupère les posts de l'utilisateur
        fetch("../../api/posts/get_feed.php?user_id=" + userId + "&only_user=1")
          .then((r) => r.json())
          .then((data) => {
            if (data.success && data.posts.length > 0) {
              document.getElementById("profile-posts").innerHTML = data.posts
                .map(
                  (post) => `
              <div class="fb-post">
                <div class="fb-post-header">
                  <img src="../../assets/images/${
                    post.avatar || "default-avatar.png"
                  }" class="fb-avatar" alt="avatar" style="cursor:pointer;">
                  <div>
                    <span class="fb-post-author">${post.prenom} ${
                    post.nom
                  }</span><br>
                    <span class="fb-post-date">${new Date(
                      post.created_at
                    ).toLocaleString("fr-FR")}</span>
                  </div>
                </div>
                <div class="fb-post-content">${post.content.replace(
                  /\n/g,
                  "<br>"
                )}</div>
                ${
                  post.image
                    ? `<img src="../../assets/images/${post.image}" class="fb-post-img" alt="image postée" style="width:100%;max-width:100%;aspect-ratio:16/9;max-height:320px;object-fit:cover;border-radius:10px;margin:8px 0;">`
                    : ""
                }
              </div>
            `
                )
                .join("");
            } else {
              document.getElementById("profile-posts").innerHTML =
                '<div style="text-align:center;">Aucun post pour cet utilisateur.</div>';
            }
          });
      }
    </script>
  </body>
</html>
